from __future__ import annotations

from ast import literal_eval

from datasets import Audio

from mteb.abstasks.Audio.AbsTaskAudioClassification import (
    AbsTaskAudioClassification,
)
from mteb.abstasks.MultilingualTask import MultilingualTask
from mteb.abstasks.TaskMetadata import TaskMetadata


class VaaniLanguageDetection(AbsTaskAudioClassification, MultilingualTask):
    metadata = TaskMetadata(
        name="IISc-Vaani-Gender-Classification",
        description="Multilingual Gender Detection -  Speech Classification.",
        reference="https://huggingface.co/datasets/ARTPARK-IISc/Vaani",
        dataset={
            "path": "ARTPARK-IISc/Vaani",
            "revision": "b133cc2e158905798a723f29685e483517e61275",
        },
        type="AudioClassification",
        category="a2t",
        eval_splits=["train"],
        eval_langs={
            # "AndhraPradesh_Anantpur": [
            #     "tel-Telu",
            #     "urd-Arab",
            #     "ben-Beng",
            #     "hin-Deva",
            #     "mar-Deva",
            #     "tam-Taml",
            #     "kan-Knda",
            # ],
            # "AndhraPradesh_Chittoor": [
            #     "tel-Telu",
            #     "hin-Deva",
            #     "tam-Taml",
            #     "ben-Beng",
            #     "sat-Olck",
            # ],
            # "AndhraPradesh_Guntur": [
            #     "tel-Telu",
            #     "hin-Deva",
            #     "ben-Beng",
            #     "mar-Deva",
            #     "tam-Taml",
            #     "eng-Latn",
            #     "urd-Arab",
            # ],
            # "AndhraPradesh_Krishna": [
            #     "hin-Deva",
            #     "tel-Telu",
            #     "mar-Deva",
            #     "ben-Beng",
            #     "tam-Taml",
            #     "eng-Latn",
            # ],
            # "AndhraPradesh_Srikakulam": [
            #     "mar-Deva",
            #     "tel-Telu",
            #     "hin-Deva",
            #     "kan-Knda",
            #     "bho-Deva",
            # ],
            # "AndhraPradesh_Vishakapattanam": [
            #     "tel-Telu",
            #     "hin-Deva",
            #     "mar-Deva",
            #     "tam-Taml",
            #     "ben-Beng",
            #     "kan-Knda",
            #     "mai-Deva",
            # ],
            # "Bihar_Araria": [
            #     "hin-Deva",
            #     "mai-Deva",
            #     "anp-Beng",
            #     "bho-Deva",
            #     "tel-Telu",
            #     "urd-Arab",
            # ],
            # "Bihar_Begusarai": [
            #     "anp-Beng",
            #     "hin-Deva",
            #     "mai-Deva",
            #     "bho-Deva",
            #     "tel-Telu",
            #     "mag-Deva",
            #     "urd-Arab",
            # ],
            # "Bihar_Bhagalpur": [
            #     "anp-Beng",
            #     "mai-Deva",
            #     "hin-Deva",
            #     "mar-Deva",
            #     "bho-Deva",
            #     "mag-Deva",
            #     "ben-Beng",
            #     "tel-Telu",
            #     "urd-Arab",
            # ],
            # "Bihar_Darbhanga": [
            #     "hin-Deva",
            #     "mai-Deva",
            #     "mar-Deva",
            #     "kan-Knda",
            #     "urd-Arab",
            # ],
            # "Bihar_EastChamparan": [
            #     "bho-Deva",
            #     "hin-Deva",
            #     "ben-Beng",
            #     "mai-Deva",
            #     "mar-Deva",
            #     "urd-Arab",
            # ],
            # "Bihar_Gaya": [
            #     "hin-Deva",
            #     "bho-Deva",
            #     "mag-Deva",
            #     "mai-Deva",
            #     "mwr-Deva",
            #     "mar-Deva",
            #     "ben-Beng",
            # ],
            # "Bihar_Gopalganj": [
            #     "hin-Deva",
            #     "bho-Deva",
            #     "mai-Deva",
            #     "ben-Beng",
            #     "mar-Deva",
            # ],
            # "Bihar_Jahanabad": [
            #     "hin-Deva",
            #     "mag-Deva",
            #     "ben-Beng",
            #     "mai-Deva",
            #     "mar-Deva",
            #     "urd-Arab",
            # ],
            # "Bihar_Jamui": [
            #     "ben-Beng",
            #     "hin-Deva",
            #     "mag-Deva",
            #     "mai-Deva",
            #     "anp-Deva",
            #     "tam-Taml",
            # ],
            # "Bihar_Kishanganj": [
            #     "hin-Deva",
            #     "mar-Deva",
            #     "ben-Beng",
            #     "mai-Deva",
            #     "mag-Deva",
            #     "sjp-Deva",
            #     "urd-Arab",
            # ],
            # "Bihar_Lakhisarai": [
            #     "hin-Deva",
            #     "mar-Deva",
            #     "bho-Deva",
            #     "mai-Deva",
            #     "mag-Deva",
            #     "kok-Deva",
            #     "tel-Telu",
            # ],
            # "Bihar_Madhepura": [
            #     "anp-Beng",
            #     "mai-Deva",
            #     "mag-Deva",
            #     "hin-Deva",
            #     "mag-Deva",
            #     "ben-Beng",
            #     "tel-Telu",
            #     "mar-Deva",
            # ],
            # "Bihar_Muzaffarpur": [
            #     "hin-Deva",
            #     "mai-Deva",
            #     "kyw-Deva",
            #     "anp-Beng",
            #     "bho-Deva",
            #     "ben-Beng",
            #     "vjk-Deva",
            # ],
            # "Bihar_Purnia": [
            #     "mai-Deva",
            #     "hin-Deva",
            #     "hne-Deva",
            #     "anp-Beng",
            #     "urd-Arab",
            # ],
            # "Bihar_Saharsa": [
            #     "anp-Beng",
            #     "hin-Deva",
            #     "mai-Deva",
            #     "mag-Deva",
            #     "hne-Deva",
            #     "ben-Beng",
            #     "kan-Knda",
            #     "urd-Arab",
            # ],
            # "Bihar_Samastipur": [
            #     "mai-Deva",
            #     "hin-Deva",
            #     "mag-Deva",
            #     "anp-Beng",
            #     "bho-Deva",
            #     "vjk-Deva",
            #     "urd-Arab",
            # ],
            # "Bihar_Saran": ["hin-Deva", "bho-Deva", "mai-Deva", "mar-Deva"],
            # "Bihar_Sitamarhi": [
            #     "hin-Deva",
            #     "vjk-Deva",
            #     "mai-Deva",
            #     "bho-Deva",
            #     "urd-Arab",
            #     "tam-Taml",
            #     "anp-Deva",
            #     "sck-Deva",
            #     "ben-Beng",
            #     "mag-Deva",
            # ],
            # "Bihar_Supaul": [
            #     "mai-Deva",
            #     "anp-Beng",
            #     "hin-Deva",
            #     "bho-Deva",
            #     "urd-Arab",
            # ],
            # "Bihar_Vaishali": [
            #     "hin-Deva",
            #     "mai-Deva",
            #     "vjk-Deva",
            #     "ben-Beng",
            #     "mar-Deva",
            #     "bho-Deva",
            #     "nep-Deva",
            # ],
            # "Chhattisgarh_Balrampur": ["hin-Deva", "hne-Deva", "awa-Deva"],
            # "Chhattisgarh_Bastar": [
            #     "hlb-Orya",
            #     "hin-Deva",
            #     "hne-Deva",
            #     "bgw-Orya",
            #     "ori-Orya",
            #     "ben-Beng",
            #     "gon-Gonm",
            # ],
            # "Chhattisgarh_Bilaspur": [
            #     "hin-Deva",
            #     "hne-Deva",
            #     "mar-Deva",
            #     "ben-Beng",
            #     "mai-Deva",
            # ],
            # "Chhattisgarh_Jashpur": [
            #     "hne-Deva",
            #     "hin-Deva",
            #     "sck-Deva",
            #     "ben-Beng",
            #     "kru-Deva",
            #     "ori-Orya",
            #     "agi-Deva",
            # ],
            # "Chhattisgarh_Kabirdham": ["hin-Deva", "hne-Deva", "mar-Deva", "mai-Deva"],
            # "Chhattisgarh_Korba": ["hin-Deva", "hne-Deva"],
            # "Chhattisgarh_Raigarh": ["hin-Deva", "hne-Deva", "ori-Orya"],
            # "Chhattisgarh_Rajnandgaon": [
            #     "hin-Deva",
            #     "kan-Knda",
            #     "hne-Deva",
            #     "ben-Beng",
            #     "mar-Deva",
            #     "eng-Latn",
            # ],
            # "Chhattisgarh_Sarguja": [
            #     "hin-Deva",
            #     "hne-Deva",
            #     "ben-Beng",
            #     "kru-Deva",
            #     "sck-Deva",
            # ],
            # "Chhattisgarh_Sukma": [
            #     "hin-Deva",
            #     "ori-Orya",
            #     "ben-Beng",
            #     "gon-Gonm",
            #     "pci-Deva",
            #     "kff-Telu",
            #     "hne-Deva",
            # ],
            # "Goa_NorthSouthGoa": [
            #     "hin-Deva",
            #     "kok-Deva",
            #     "ben-Beng",
            #     "guj-Gujr",
            #     "mar-Deva",
            #     "kan-Knda",
            #     "eng-Latn",
            # ],
            # "Jharkhand_Jamtara": [
            #     "hin-Deva",
            #     "mar-Deva",
            #     "bho-Deva",
            #     "mai-Deva",
            #     "ben-Beng",
            #     "mag-Deva",
            # ],
            # "Jharkhand_Sahebganj": [
            #     "hin-Deva",
            #     "anp-Deva",
            #     "mar-Deva",
            #     "bho-Deva",
            #     "mag-Deva",
            #     "sat-Olck",
            #     "hne-Deva",
            #     "kyw-Deva",
            #     "eng-Latn",
            #     "ben-Beng",
            #     "mag-Deva",
            # ],
            # "Karnataka_Belgaum": [
            #     "hin-Deva",
            #     "kan-Knda",
            #     "mar-Deva",
            #     "mal-Mlym",
            #     "tel-Telu",
            #     "urd-Arab",
            # ],
            # "Karnataka_Bellary": [
            #     "kan-Knda",
            #     "hin-Deva",
            #     "urd-Arab",
            #     "tel-Telu",
            #     "tam-Taml",
            #     "eng-Latn",
            #     "mal-Mlym",
            # ],
            # "Karnataka_Bijapur": [
            #     "kan-Knda",
            #     "hin-Deva",
            #     "mal-Mlym",
            #     "tel-Telu",
            #     "urd-Arab",
            #     "ben-Beng",
            #     "eng-Latn",
            # ],
            # "Karnataka_Chamrajnagar": [
            #     "kan-Knda",
            #     "hin-Deva",
            #     "mal-Mlym",
            #     "tel-Telu",
            #     "tam-Taml",
            # ],
            # "Karnataka_DakshinKannada": [
            #     "kan-Knda",
            #     "hin-Deva",
            #     "urd-Arab",
            #     "tel-Telu",
            #     "tcy-Tutg",
            #     "mal-Mlym",
            # ],
            # "Karnataka_Dharwad": [
            #     "kan-Knda",
            #     "hin-Deva",
            #     "bho-Deva",
            #     "mal-Mlym",
            #     "tel-Telu",
            #     "urd-Arab",
            # ],
            # "Karnataka_Gulbarga": [
            #     "kan-Knda",
            #     "hin-Deva",
            #     "tel-Telu",
            #     "mal-Mlym",
            #     "urd-Arab",
            # ],
            # "Karnataka_Mysore": [
            #     "hin-Deva",
            #     "kan-Knda",
            #     "mal-Mlym",
            #     "ben-Beng",
            #     "tam-Taml",
            #     "urd-Arab",
            #     "lmn-Deva",
            #     "tel-Telu",
            # ],
            # "Karnataka_Raichur": [
            #     "kan-Knda",
            #     "hin-Deva",
            #     "tel-Telu",
            #     "bho-Deva",
            #     "mal-Mlym",
            #     "urd-Arab",
            # ],
            # "Karnataka_Shimoga": [
            #     "kan-Knda",
            #     "hin-Deva",
            #     "tel-Telu",
            #     "mal-Mlym",
            #     "tam-Taml",
            #     "ben-Beng",
            #     "urd-Arab",
            # ],
            # "Maharashtra_Aurangabad": ["mar-Deva", "hin-Deva", "ben-Beng", "tel-Telu"],
            # "Maharashtra_Chandrapur": ["hin-Deva", "mar-Deva", "kok-Deva"],
            # "Maharashtra_Dhule": ["hin-Deva", "mar-Deva", "bhb-Deva", "khn-Deva"],
            # "Maharashtra_Nagpur": [
            #     "hin-Deva",
            #     "mar-Deva",
            #     "kok-Deva",
            #     "hne-Deva",
            #     "guj-Gujr",
            # ],
            # "Maharashtra_Pune": ["mar-Deva", "hin-Deva", "mai-Deva", "urd-Arab"],
            # "Maharashtra_Sindhudurga": ["hin-Deva", "mar-Deva", "kok-Deva"],
            # "Maharashtra_Solapur": [
            #     "mar-Deva",
            #     "hin-Deva",
            #     "kok-Deva",
            #     "mai-Deva",
            #     "ben-Beng",
            #     "kan-Knda",
            # ],
            # "Rajasthan_Churu": [
            #     "hin-Deva",
            #     "swv-Deva",
            #     "wbr-Deva",
            #     "mwr-Deva",
            #     "bgq-Deva",
            #     "mtr-Deva",
            #     "ben-Beng",
            #     "hoj-Deva",
            #     "dhd-Deva",
            #     "guj-Gujr",
            #     "eng-Latn",
            #     "raj-Deva",
            #     "wtm-Deva",
            # ],
            # "Rajasthan_Nagaur": [
            #     "hin-Deva",
            #     "mwr-Deva",
            #     "ben-Beng",
            #     "dhd-Deva",
            #     "mar-Deva",
            #     "mtr-Deva",
            #     "raj-Deva",
            # ],
            # "Telangana_Karimnagar": [
            #     "tel-Telu",
            #     "hin-Deva",
            #     "eng-Latn",
            #     "ben-Beng",
            #     "urd-Arab",
            # ],
            # "Telangana_Nalgonda": [
            #     "tel-Telu",
            #     "hin-Deva",
            #     "ben-Beng",
            #     "mal-Mlym",
            #     "lmn-Deva",
            # ],
            # "UttarPradesh_Budaun": [
            #     "hin-Deva",
            #     "bns-Deva",
            #     "awa-Deva",
            #     "mar-Deva",
            #     "ben-Beng",
            #     "urd-Arab",
            # ],
            # "UttarPradesh_Deoria": [
            #     "bho-Deva",
            #     "hin-Deva",
            #     "awa-Deva",
            #     "mai-Deva",
            #     "mar-Deva",
            # ],
            # "UttarPradesh_Etah": ["hin-Deva", "eng-Latn", "mar-Deva"],
            # "UttarPradesh_Ghazipur": [
            #     "bho-Deva",
            #     "hin-Deva",
            #     "ben-Beng",
            #     "awa-Deva",
            #     "mar-Deva",
            #     "hne-Deva",
            #     "urd-Arab",
            #     "tam-Taml",
            # ],
            # "UttarPradesh_Gorakhpur": ["bho-Deva", "hin-Deva", "mar-Deva"],
            # "UttarPradesh_Hamirpur": [
            #     "hin-Deva",
            #     "urd-Arab",
            #     "mar-Deva",
            #     "bns-Deva",
            #     "awa-Deva",
            #     "ben-Beng",
            # ],
            # "UttarPradesh_Jalaun": [
            #     "hin-Deva",
            #     "bns-Deva",
            #     "awa-Deva",
            #     "mar-Deva",
            #     "asm-Beng",
            #     "guj-Gujr",
            # ],
            # "UttarPradesh_JyotibaPhuleNagar": ["hin-Deva", "mar-Deva", "urd-Arab"],
            # "UttarPradesh_Muzzaffarnagar": [
            #     "hin-Deva",
            #     "mar-Deva",
            #     "kan-Knda",
            #     "awa-Deva",
            #     "urd-Arab",
            # ],
            # "UttarPradesh_Varanasi": [
            #     "hin-Deva",
            #     "bho-Deva",
            #     "mar-Deva",
            #     "awa-Deva",
            #     "ben-Beng",
            # ],
            # "Uttarakhand_TehriGarhwal": [
            #     "gbm-Deva",
            #     "hin-Deva",
            #     "ben-Beng",
            #     "kfy-Deva",
            #     "mar-Deva",
            # ],
            # "Uttarakhand_Uttarkashi": [
            #     "hin-Deva",
            #     "gbm-Deva",
            #     "ben-Beng",
            #     "kfy-Deva",
            #     "mai-Deva",
            #     "mar-Deva",
            # ],
            # "WestBengal_DakshinDinajpur": ["hin-Deva", "ben-Beng"],
            # "WestBengal_Jalpaiguri": ["ben-Beng", "mar-Deva", "hin-Deva", "sck-Deva"],
            # "WestBengal_Jhargram": ["hin-Deva", "mar-Deva", "ben-Beng", "bho-Deva"],
            # "WestBengal_Kolkata": ["ben-Beng", "hin-Deva"],
            # "WestBengal_Malda": ["ben-Beng", "mar-Deva", "hin-Deva"],
            # "WestBengal_North24Parganas": ["ben-Beng", "hin-Deva", "mar-Deva"],
            # "WestBengal_PaschimMedinipur": ["ben-Beng", "hin-Deva"],
            "WestBengal_Purulia": ["ben-Beng", "hin-Deva", "rjs-Beng", "sat-Olck"],
        },
        main_score="accuracy",
        date=(
            "2024-12-01",
            "2025-01-18",
        ),
        domains=["Academic", "Spoken", "Scene", "Speech"],
        task_subtypes=["Language identification", "Spoken Language Identification"],
        license="cc-by-4.0",
        annotations_creators="human-annotated",
        dialect=[],
        modalities=["audio"],
        sample_creation="created",
        bibtex_citation="""@misc{vaani2025,
        author       = {VAANI Team},
        title        = {VAANI: Capturing the Language Landscape for an Inclusive Digital India (Phase 1)},
        howpublished = {{https://vaani.iisc.ac.in/}},
        year         = {2025}
        }
        """,
    )

    audio_column_name: str = "audio"
    label_column_name: str = "gender"
    samples_per_label: int = 32

    def dataset_transform(self):
        N_SAMPLES = 2048
        for subset in self.hf_subsets:
            self.dataset[subset] = self.dataset[subset].cast_column(
                self.audio_column_name, Audio(16_000)
            )
            self.dataset[subset] = self.stratified_subsampling(
                self.dataset[subset],
                seed=self.seed,
                splits=["train"],
                label=self.label_column_name,
                n_samples=N_SAMPLES,
            )
